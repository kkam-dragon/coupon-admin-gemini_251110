# 📘 COUFUN B2C 연동 매뉴얼 – 교환정보 (Ver. 1.6)

**작성자:** ㈜티사이언티픽  
**최종 개정일:** 2021.03.11  
**문서 버전:** 1.6  

---

## 🕓 개정 이력

| 버전 | 개정일자 | 개정 내역 | 작성/개정자 | 확인자 |
|:----:|:----------|:-----------|:-------------|:--------|
| 1.5 | 2020-08-21 | 개정이력 추가, 사명 변경 | 송도화 | - |
| 1.6 | 2021-03-11 | 팀/담당자 변경 | 송도화 | - |

---

## 1️⃣ 개요 (Overview)

본 문서는 **㈜티사이언티픽의 E-Coupon 시스템과 연동하여 쿠폰의 사용 및 사용취소 정보를 실시간으로 전달**받기 위한 가이드입니다.

---

## 2️⃣ API 정보

### 📡 사용/사용취소 정보 전달

- 실시간으로 **쿠폰 사용 및 취소(교환/교환취소)** 정보를 전달합니다.
- HTTP **POST 방식**으로만 연동 가능하며, **SOAP 또는 Socket 방식은 지원하지 않습니다.**
- **Parameter 명칭은 모두 영문 대문자**로 작성해야 합니다.

### ⚠️ 유의사항

1. 본 API 사용을 위해서는 **사전 권한 승인이 필요**합니다.  
   → (주)티사이언티픽 **제휴영업팀**과 협의 필수  
2. 공급 방식에 따라 **권한 제한**이 있을 수 있습니다.  
3. 일부 브랜드/상품은 본 기능이 제공되지 않을 수 있습니다.  
4. 응답 데이터는 반드시 **숫자 또는 영문만** 사용해야 합니다.  
5. 개발 완료 후, **연동 가능한 URL을 마케팅운영팀에 제출**해야 합니다.  

---

## 3️⃣ 담당자 안내

| 팀명 | 담당자 | 연락처 | 이메일 | 비고 |
|:----|:------|:------|:------|:------|
| 마케팅운영팀 | 김태현 대리 | 02-2181-8082 | design@tscientific.co.kr | 연동 파라미터 발급 |
| 제휴영업팀 | 김연준 팀장 | 02-2181-8031 | aff@tscientific.co.kr | 상품 및 공급조건 문의 |

---

## 4️⃣ 요청 데이터 구조 (티사이언티픽 → 업체)

### 📤 Request Parameters

| 변수명 | 최대길이 | 설명 |
|:------|:----------|:------|
| `BARCODE_NUM` | 30byte | 쿠폰번호 |
| `EXCHANGE_NUM` | 30byte | 사용/사용취소 인증번호 |
| `STATUS` | 3byte | 쿠폰 상태 (`000`: 미사용, `001`: 사용, `100`: 취소) |
| `EXCHANGE_DATE` | 14byte | 사용/취소 시간 (YYYYMMDDHH24MISS) |
| `BRANCH_NAME` | 50byte | 사용/취소된 지점명 |
| `BRANCH_CODE` | 20byte | 사용/취소된 지점코드 |
| `BARCODE_TYPE` | 10byte | 쿠폰 종류 (`BARCODE`: 교환권, `AMOUNT`: 금액권) |
| `PRICE` | 10byte | 쿠폰 금액 (`BARCODE`: 공급가, `AMOUNT`: 사용된 금액) |
| `BALANCE` | 10byte | 잔액 (`BARCODE`: 0, `AMOUNT`: 잔액) |

> ※ `( * )` 표시는 필수 항목입니다.  
> `BRANCH_NAME`이 없을 경우 `BRANCH_CODE`와 동일한 값이 출력되거나 빈값으로 전달됩니다.

### 🧾 BARCODE_TYPE 설명

| 타입 | 설명 | 예시 |
|:----|:----|:----|
| `BARCODE` | 1:1 교환 가능한 쿠폰 | 비타500, CGV영화권 |
| `AMOUNT` | 금액권 (분할 사용 가능) | GS금액권, 세븐금액권 |

> ⚠️ **주의:**  
> 상품명이 ‘금액권’이라도 분할 사용이 불가능한 경우 `BARCODE` 타입으로 분류됩니다.  
> 예: 아웃백금액권, 신세계상품권  
>
> `AMOUNT` 타입의 쿠폰은 **잔액이 0이 될 때까지 여러 번 사용 가능**하며,  
> 사용(교환)정보가 **1회 이상 전송될 수 있습니다.**

---

## 5️⃣ 응답 데이터 구조 (업체 → 티사이언티픽)

### 📥 Response Parameters

| 변수명 | 최대길이 | 설명 |
|:------|:----------|:------|
| `RESULTCODE` | 2byte | 연동 결과 코드 |
| `RESULTMSG` | 256byte | 연동 결과 메시지 (영문으로 응답 예: `Success`) |
| `EXCHANGE_ID` | 50byte | 요청에 대한 처리 ID |

> ※ `( * )` 표시는 필수 항목입니다.  
> 응답 결과는 **로그 형태로 반드시 관리**해야 합니다.  
> ‘00’(성공) 코드 미수신 시, **10분 간격으로 재시도**합니다.  
> **중복 요청 수신 시 ‘00’ 또는 ‘04’ 코드로 응답**해야 합니다.

---

## 6️⃣ 응답 예시

### ✅ 성공 시
```xml
<?xml version="1.0" encoding="EUC-KR"?>
<COUPONEXCHANGE>
  <RESULTCODE>00</RESULTCODE>
  <RESULTMSG>Success</RESULTMSG>
  <EXCHANGE_ID>ABC123456</EXCHANGE_ID>
</COUPONEXCHANGE>
```

### ❌ 실패 시
```xml
<?xml version="1.0" encoding="EUC-KR"?>
<COUPONEXCHANGE>
  <RESULTCODE>99</RESULTCODE>
  <RESULTMSG>Error</RESULTMSG>
</COUPONEXCHANGE>
```

---

## 7️⃣ 응답 코드 정의

| 코드 | 메시지 | 설명 |
|:----:|:--------|:------|
| 00 | 처리완료 | 정상 처리 |
| 01 | 등록 IP 오류 | 등록되지 않은 IP |
| 03 | 쿠폰번호 오류 | 존재하지 않는 쿠폰번호 |
| 04 | 중복 오류 | 중복된 데이터 |
| 99 | 기타 오류 | 기타 시스템 오류 |

---

## 8️⃣ 기술지원

- **소속:** ㈜티사이언티픽 / R&D 센터 / 전산운영팀  
- **이메일:** [devops@tscientific.co.kr](mailto:devops@tscientific.co.kr)  
- **업무시간:** 평일 10:00 ~ 18:00  
- ⚠️ 본 문서의 **무단 열람, 사용, 수정, 공개, 배포는 금지**됩니다.
