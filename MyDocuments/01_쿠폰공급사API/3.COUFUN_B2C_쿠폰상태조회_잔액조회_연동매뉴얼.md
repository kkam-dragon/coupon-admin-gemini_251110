# 📘 COUFUN B2C 연동 매뉴얼 – 쿠폰상태조회(잔액조회) (Ver. 1.3)

**작성자:** ㈜티사이언티픽  
**최종 개정일:** 2023.09.15  
**문서 버전:** 1.3  

---

## 🕓 개정 이력

| 버전 | 개정일자 | 개정 내역 | 작성/개정자 | 확인자 |
|:----:|:----------|:-----------|:-------------|:--------|
| 1.0 | 2012-01-03 | 초안 작성 | 정철 | - |
| 1.1 | 2018-07-11 | 상용 URL 프로토콜 변경 | 송도화 | - |
| 1.2 | 2020-08-21 | 사명 변경 | 송도화 | - |
| 1.2.1 | 2023-01-09 | 팀명 변경 | 송도화 | - |
| 1.3 | 2023-09-15 | 금액권 잔액조회 추가 | 김보람 | - |

---

## 1️⃣ 개요

본 문서는 **㈜티사이언티픽의 모바일커머스 시스템과 연동에 필요한 쿠폰 상태 및 잔액조회 절차**를 기술한 문서이다.

### 🧭 Service Flow

1. 주문상태 조회 요청  
2. 요청 데이터 검증  
3. 결과 리턴  
4. 상태 출력  

---

## 2️⃣ 시스템 정보

### ✅ 쿠폰 상태조회(잔액조회) URL

| 구분 | URL | 비고 |
|:----|:----|:----|
| **상용 URL** | `https://corp.coufun.kr:446/b2c_api/coufunPartAmountStatus.do` | - |
| **테스트 URL** | `https://tcorp.coufun.kr:446/b2c_api/coufunPartAmountStatus.do` | - |

### ⚙️ 연동정보

- **HTTP POST 방식 호출**
- **XML 형식의 결과값 리턴**

### ⚠️ 유의사항

1. 반드시 **테스트 서버를 통해 연동 구현 후 상용 서버에 적용**  
2. **IP 등록이 필요하며, 미등록 시 사전 요청 필요**  

---

## 3️⃣ 연동 인터페이스

### 📄 정의

클라이언트의 상태 요청 데이터를 이용하여 시스템이 데이터 검증 후, **정상 쿠폰일 경우 결과를 리턴**한다.

### 🌐 연동 URL (테스트용)

```
https://tcorp.coufun.kr:446/b2c_api/coufunPartAmountStatus.do
```

---

## 4️⃣ 요청 파라미터

| 변수명 | 타입 | 설명 | 최대길이 | 체크 |
|:------|:------|:------|:----------|:------|
| `POC_ID` | STRING | 고객사 ID | 10byte | 필수 |
| `GOODS_ID` | STRING | 판매상품 ID | 10byte | 필수 |
| `BARCODE_NUM` | STRING | 쿠폰번호 | 30byte | 필수 |

---

## 5️⃣ 응답 파라미터

| 변수명 | 타입 | 설명 | 최대길이 |
|:------|:------|:------|:----------|
| `RESULT_CODE` | STRING | 실행 결과 코드 | 2byte |
| `RESULT_MSG` | STRING | 실행 결과 메시지 | 100byte |
| `COUPON_TYPE` | STRING | 쿠폰타입 (`BARCODE`: 교환권, `AMOUNT`: 금액권) | 10byte |
| `ORDER_DATE` | STRING | 주문일 (YYYYMMDD) | 8byte |
| `STATUS` | STRING | 쿠폰 상태 (`000`: 미사용, `001`: 사용, `100`: 취소) | 3byte |
| `RECEIVER_MOBILE` | STRING | 수신번호 (휴대폰번호) | 11byte |
| `BARCODE_NUM` | STRING | 쿠폰번호 | 30byte |
| `VALID_END_DATE` | STRING | 쿠폰유효기간 (YYYYMMDD) | 8byte |
| `EXCHANGE_DATE` | STRING | 교환일시 (YYYYMMDDHHMISS, 교환/교환취소 시 출력) | 14byte |
| `CANCEL_DATE` | STRING | 취소일시 (YYYYMMDDHHMISS, 취소 시 출력) | 14byte |
| `TOTAL_AMOUNT` | STRING | 총 금액 (쿠폰타입이 AMOUNT일 때 출력) | 10byte |
| `REMAIN_AMOUNT` | STRING | 남은 금액 (쿠폰타입이 AMOUNT일 때 출력) | 10byte |

> ※ `*` 표시는 필수 응답 필드임.

---

## 6️⃣ 응답 예시

### ✅ 성공 시
```xml
<?xml version="1.0" encoding="EUC-KR"?>
<COUFUNSEARCH>
  <RESULT_CODE>00</RESULT_CODE>
  <RESULT_MSG>SUCCESS</RESULT_MSG>
  <COUPON_TYPE>AMOUNT</COUPON_TYPE>
  <ORDER_DATE>20230915</ORDER_DATE>
  <STATUS>000</STATUS>
  <RECEIVER_MOBILE>01012345678</RECEIVER_MOBILE>
  <BARCODE_NUM>ABC1234567890</BARCODE_NUM>
  <VALID_END_DATE>20231231</VALID_END_DATE>
  <EXCHANGE_DATE>20230915123000</EXCHANGE_DATE>
  <CANCEL_DATE></CANCEL_DATE>
  <TOTAL_AMOUNT>10000</TOTAL_AMOUNT>
  <REMAIN_AMOUNT>2500</REMAIN_AMOUNT>
</COUFUNSEARCH>
```

> 여러 건인 경우 `<ORDER_INFO>` 블록이 주문 건수만큼 반복됨 (최대 10건).

### ❌ 실패 시
```xml
<?xml version="1.0" encoding="EUC-KR"?>
<COUFUNSEARCH>
  <RESULT_CODE>99</RESULT_CODE>
  <RESULT_MSG>ERROR MESSAGE</RESULT_MSG>
</COUFUNSEARCH>
```

---

## 7️⃣ 결과 코드 명세

별도 문서 참조:  
**`COUFUN_B2C_연동규격서_결과코드명세.pdf`**

---

## 8️⃣ 문의처

- **담당부서:** 개발팀  
- **이메일:** [devops@tscientific.co.kr](mailto:devops@tscientific.co.kr)
