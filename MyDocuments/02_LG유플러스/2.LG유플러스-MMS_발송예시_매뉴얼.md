# 📘 MMS 발송 예시 (UMS_MSG 테이블 기준)

**문서명:** MMS 발송 예시  
**출처:** [MessageHub Agent (msghub-agent.notion.site)](https://msghub-agent.notion.site/MMS-33d03fe832404bc5add92889caa64141)  
**작성일:** 2025-10-17  

---

## 1️⃣ 개요

이 문서는 **UMS_MSG 테이블을 이용하여 통합 템플릿 등록 없이 MMS만 발송하는 방법**을 설명합니다.  
(기준: MySQL)

> ⚠️ 메시지 허브 에이전트에서는 가능하면 **통합 발송을 권장**합니다.  

기존 발송 테이블(`SC_TRAN`, `MMS_MSG`)을 통해서도 MMS 발송이 가능하지만,  
본 문서에서는 **UMS_MSG**를 사용하는 방법만을 설명합니다.  
기존 방식은 **U+ 통합클라이언트 매뉴얼**을 참고하세요.  
👉 [U+ SMS 통합클라이언트 자료실 바로가기](https://sms.uplus.co.kr/ver2/jsp/customer/clientData.jsp)

---

## 2️⃣ 공통 확인 사항

- `CLIENT_KEY`는 메시지의 고유 키로, **서버 내에서 중복되지 않도록 유니크하게 생성해야 합니다.**
- 예시 키 생성 로직:
```sql
CONCAT(
  DATE_FORMAT(NOW(), '%Y%c%dT%H%i%s-'),
  FLOOR(0 + (RAND() * ((9999 - 0) + 1)))
);
```
예시 결과:  
`20251017T142205-1234`

---

## 3️⃣ MMS 발송 방법

### ✅ 1. 로컬 이미지 경로로 첨부 발송

- `MMS_FILE_LIST` 항목에 **이미지의 경로를 입력**합니다.  
- 절대경로 또는 상대경로 모두 가능하며, **최대 3개까지 쉼표(,)로 구분하여 입력 가능**합니다.

#### 📄 SQL 예시
```sql
INSERT INTO UMS_MSG 
(CLIENT_KEY, REQ_CH, TRAFFIC_TYPE, MSG_STATUS, REQ_DATE, CALLBACK_NUMBER, MSG, PHONE, TITLE, MMS_FILE_LIST) 
VALUES 
('고유key번호', 'MMS', 'normal', 'ready', NOW(), '발신번호', 'MMS발송 테스트', '수신번호', '[MMS TEST]', 'C:\test.jpg');
```
> ▶ 예시: **절대경로로 이미지 1개 첨부 후 발송**

---

### ✅ 2. 이미지의 URL 주소로 첨부 발송

- `MMS_FILE_LIST` 항목에 **이미지 URL을 입력**합니다.  
- URL의 마지막에는 반드시 **확장자를 포함한 파일명**이 있어야 합니다.  
- 최대 3개의 URL을 쉼표(,)로 구분하여 입력 가능합니다.

#### 📄 SQL 예시
```sql
INSERT INTO UMS_MSG 
(CLIENT_KEY, REQ_CH, TRAFFIC_TYPE, MSG_STATUS, REQ_DATE, CALLBACK_NUMBER, MSG, PHONE, TITLE, MMS_FILE_LIST) 
VALUES 
(CONCAT(DATE_FORMAT(NOW(), '%Y%c%dT%H%i%s-'), FLOOR(0 + (RAND() * ((9999 - 0) + 1)))),
 'MMS', 'normal', 'ready', NOW(), '15445992', 'MMS발송 테스트', '01085697089', '[MMS TEST]',
 'https://www.usatoday.com/gcdn/media/2022/01/25/USATODAY/usatsports/pokemongames-ranked-10.jpg');
```
> ▶ 예시: **URL 이미지 1개 첨부 후 발송**

---

### ✅ 3. 메시지허브에 등록된 File ID로 발송

- `MMS_FILE_LIST` 항목에 **사전 등록된 File ID**를 입력합니다.  
- 반드시 **메시지허브 콘솔에 등록된 File ID**여야 하며,  
  최대 3개까지 쉼표(,)로 구분하여 입력 가능합니다.

#### 📄 SQL 예시
```sql
INSERT INTO UMS_MSG 
(CLIENT_KEY, REQ_CH, TRAFFIC_TYPE, MSG_STATUS, REQ_DATE, CALLBACK_NUMBER, MSG, PHONE, TITLE, MMS_FILE_LIST) 
VALUES 
(CONCAT(DATE_FORMAT(NOW(), '%Y%c%dT%H%i%s-'), FLOOR(0 + (RAND() * ((9999 - 0) + 1)))),
 'MMS', 'normal', 'ready', NOW(), '15445992', 'MMS발송 테스트', '01085697089', '[MMS TEST]', 'ack4_25-2mbj29Lsi4j_');
```
> ▶ 예시: **File ID를 이용한 이미지 발송**

---

## 4️⃣ 발송 후 이미지 저장 위치

- `MMS_FILE_LIST`에 경로 또는 URL을 입력하여 발송 시,  
  **SNAP 에이전트 홈 경로 내 `yyyymmdd` 형식의 폴더에 이미지가 저장**됩니다.
- 또한 **MSGHUB_IMG 테이블**에 이미지가 **자동 등록**됩니다.

---

## 🧾 요약

| 구분 | 첨부 방식 | 입력 위치 | 비고 |
|:----|:----|:----|:----|
| 로컬 이미지 | PC 내 파일 경로 | `MMS_FILE_LIST` | 최대 3개 첨부 가능 |
| URL 이미지 | 이미지 URL 주소 | `MMS_FILE_LIST` | 확장자 포함 필요 |
| File ID | 메시지허브 등록 ID | `MMS_FILE_LIST` | 사전등록 필수 |

---

📩 **참고:**  
발송 시 INSERT된 레코드는 `UMS_MSG`에서 상태 변화(`msg_status`) 후  
로그 테이블 `UMS_LOG_YYYYMM`으로 이관됩니다.

