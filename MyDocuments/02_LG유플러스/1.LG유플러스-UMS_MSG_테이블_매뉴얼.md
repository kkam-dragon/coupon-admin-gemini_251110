# 📘 UMS_MSG 테이블 매뉴얼 (Full • Notion 스타일)

> 본 문서는 UMS_MSG Notion 가이드를 **전체 구조로 Markdown화**한 것입니다. 섹션/표/코드블록을 Notion과 유사하게 구성했습니다. fileciteturn8file0

---

## 1. 개요

`UMS_MSG`는 **문자, RCS, 카카오톡, PUSH**를 동일한 스키마로 발송할 수 있는 **통합 메시지 발송 테이블**입니다. 또한 미리 설정한 채널 순서에 맞춰 발송하는 **통합발송** 시에도 이 테이블로 발송할 수 있으나, **통합 템플릿 발송은 KV_MSG 테이블 사용을 권장**합니다. 발송이 완료되면 `msg_status`가 `complete`로 변경되며 **로그 테이블(`UMS_LOG_YYYYMM`)**로 이관됩니다. 로그 테이블의 스키마는 발송 테이블과 동일합니다. fileciteturn8file0

---

## 2. 스키마 변경 사항 안내

> (구) 허브 에이전트를 사용하던 고객의 경우 `UMS_MSG` 테이블의 일부 컬럼이 **변경/추가/삭제/이름변경** 되었습니다. 아래 항목을 반드시 확인하세요. fileciteturn8file0

- 컬럼 사이즈 변경  
- 컬럼 추가  
- 컬럼명 변경  
- 컬럼 제거

---

## 3. 컬럼 정의서

> 표의 값(길이/NULL/설명)은 원문 표기를 최대한 반영했습니다. 화살표(←)는 **이전 컬럼명**을 의미합니다. fileciteturn8file0

| 컬럼명 | 타입 | 길이 | NULL | 설명 |
|---|---:|---:|:---:|---|
| **CLIENT_KEY** | VARCHAR | 40 | NOT NULL | 메시지 고유 번호 (예: datetime + business name + random string) |
| **REQ_CH** (← REQ_PRODUCT) | VARCHAR | 10 | NOT NULL | 발송 채널: 문자(SMS, MMS), 글로벌 SMS(GDS), RCS(RCS), 카카오(ALIMTALK, FRIENDTALK), PUSH(PUSH), 템플릿 통합발송(UMS) |
| **TRAFFIC_TYPE** | VARCHAR | 10 |  | 메시지 유형: `normal`(기본), `real`(실시간/중요), `batch`(마케팅/광고) |
| **MSG_STATUS** | VARCHAR | 10 | NOT NULL | 발송 상태: `ready`(insert 상태), `request`(발송 완료), `complete`(결과 수신 완료), `pre-send`(select 완료), `pre-image`(이미지 등록 작업 중) |
| **REQ_DATE** | datetime | - | NOT NULL | 발송 요청 시간 (미래시간 입력 시 예약 발송) |
| **CALLBACK_NUMBER** | VARCHAR | 16 | NOT NULL | 발신번호 (문자/RCS 필수) |
| **KISA_ORIGCODE** (← MSG_BIZ_KEY) | VARCHAR | 20 |  | KISA 최초 발신사업자 구분 코드 (재판매사 필수, 일반 고객 공란) |
| **CAMPAIGN_ID** | VARCHAR | 20 |  | 캠페인 단위 통계용 ID |
| **DEPT_CODE** | VARCHAR | 20 |  | 부서코드 (부서별 빌링용) |
| **PHONE** | VARCHAR | 16 |  | 수신번호 |
| **MSG** | VARCHAR | 2000 |  | 전송할 메시지 내용 (가변 데이터: `#{NAME}` 형식) |
| **TITLE** | VARCHAR | 100 |  | 제목 (LMS/MMS/RCS/ALIMTALK/PUSH 발송 시 사용) |
| **TEMPLATE_CODE** | VARCHAR | 20 |  | 메시지허브(허브 콘솔) 등록 **통합발송 템플릿 키** |
| **MERGE_DATA** | VARCHAR | 2000 |  | 가변 데이터 JSON 예: `{ "NAME":"홍길동","SHOP":"이마트 용산" }` |
| **FILE_DATA** | VARCHAR | 1000 |  | 템플릿 이미지 변경 발송 데이터 (예: `rcs.1.path`, `friendtalk.1.url.y` 등 키-값) |
| **MMS_FILE_LIST** (← FILE_LIST) | VARCHAR | 450 / 600 |  | MMS 파일 (최대 3개, `,` 구분) |
| **FB_CH** (← FB_PRODUCT) | VARCHAR | 10 |  | Fallback 발송 채널 (SMS/LMS/MMS만 가능) |
| **FB_MSG** | VARCHAR | 4000 |  | Fallback 메시지 내용 |
| **FB_TITLE** | VARCHAR | 100 |  | Fallback 메시지 제목 |
| **FB_FILE_LIST** (← FB_FILE_ID) | VARCHAR | 450 / 60 |  | Fallback MMS 파일 (최대 3개, `,` 구분) |
| **RCS_MSGBASE_ID** | VARCHAR | 40 |  | RCS 메시지베이스 ID |
| **RCS_HEADER** | VARCHAR | 1 |  | RCS 메시지 유형: `0` 정보성, `1` 광고성 |
| **RCS_FOOTER** | VARCHAR | 16 |  | 무료수신거부번호 |
| **RCS_COPY_ALLOWED_YN** | VARCHAR | 1 |  | 복사/공유 허용 여부: `Y`(기본), `N`(미허용) |
| **RCS_EXPIRY_OPTION** | VARCHAR | 1 |  | 발송 타임아웃 옵션: `1` 72시간, `2` 30초, `3` 3분, `4` 1시간 |
| **RCS_AGENCY_ID** | VARCHAR | 20 |  | 대행사 ID (예: `lguplus`) |
| **RCS_AGENCY_KEY** | VARCHAR | 20 |  | 대행사 인증 Key (대행사 agencyId 사용 시 필수) |
| **RCS_BRAND_KEY** | VARCHAR | 20 |  | 발신번호가 속한 **브랜드 Key** (브랜드별 부여) |
| **RCS_BUTTON** | VARCHAR | 1000 |  | RCS 버튼 Object array |
| **KAKAO_CH_ID** (← KAKAO_SENDER_KEY) | VARCHAR | 65 |  | 카카오톡 채널 아이디 |
| **KAKAO_TEMPLATE_CODE** (← KAKAO_TEMPLATE_KEY) | VARCHAR | 20 |  | 알림톡/친구톡 템플릿 코드 |
| **KAKAO_BUTTON** | VARCHAR | 1000 |  | 카카오 버튼 Object |
| **KAKAO_IMAGE_WIDE_YN** | VARCHAR | 1 |  | 친구톡 와이드 이미지 여부 (`Y/N`) |
| **KAKAO_IMAGE_URL** | VARCHAR | 150 / 200 |  | 친구톡 이미지 URL |
| **KAKAO_IMAGE_LINK** | VARCHAR | 150 / 200 |  | 친구톡 이미지 링크 |
| **KAKAO_FILE** (← KAKAO_FILE_ID) | VARCHAR | 150 / 20 |  | 친구톡 이미지 파일 |
| **KAKAO_AD_FLAG** | VARCHAR | 1 |  | 광고 표기 여부 (`Y/N`) |
| **KAKAO_GROUP_KEY** | VARCHAR | 100 / 200 |  | 알림톡 그룹 발송용 KEY |
| **PUSH_APP_ID** | VARCHAR | 255 |  | 메시지허브 관리자 콘솔 등록 **APP ID** |
| **PUSH_PROVIDER** | VARCHAR | 20 |  | `FCM`(구글), `APNS`(애플) |
| **PUSH_APP_USER_ID** | VARCHAR | 20 |  | 앱 사용자 아이디 |
| **PUSH_FILE** (← PUSH_FILE_ID) | VARCHAR | 150 / 20 |  | PUSH 이미지 파일 |
| **PUSH_EXT** | VARCHAR | 1000 |  | 이미지 푸시용 URL 또는 앱 상세 페이지 구성 데이터(JSON) |
| **ROUTE_INFO** (← API_KEY) | VARCHAR | 20 |  | 발송된 세션 ID / API Key (다중 세션 중 실제 발송 세션) |
| **SENT_DATE** | datetime | - |  | Agent가 메시지허브 G/W로 **발송한 시간** |
| **DONE_CH** | VARCHAR | 10 |  | 발송 성공 채널 |
| **DONE_PRODUCT** | VARCHAR | 10 |  | 발송 성공 상품 종류 |
| **DONE_DATE** | datetime | - |  | **단말 전달 시간** or **실패 최종 시간** |
| **DONE_CODE** | VARCHAR | 10 |  | 처리 결과 코드 |
| **DONE_CODE_DESC** | VARCHAR | 200 |  | 처리 결과 상세 |
| **DONE_FB_DETAIL** | VARCHAR | 1000 |  | 첫 채널 실패 후 다음 채널 발송 시, 첫 채널의 실패 코드/설명 |
| **DONE_TELCO** | VARCHAR | 10 |  | 문자/RCS 발송 성공 시 **이통사 코드** |
| **ETC1** | VARCHAR | 50 |  | 고객사 예비 필드1 |
| **ETC2** | VARCHAR | 50 |  | 고객사 예비 필드2 |
| **ETC3** | VARCHAR | 50 |  | 고객사 예비 필드3 |
| **ETC4** | VARCHAR | 50 |  | 고객사 예비 필드4 |
| **ETC5** | VARCHAR | 50 |  | 고객사 예비 필드5 |
| **ETC6** | VARCHAR | 50 |  | 고객사 예비 필드6 |

> **비고:** 일부 행의 길이 칸에 `A / B`처럼 **두 값이 병기**된 것은 원문에 서로 다른 길이 표기가 혼재되어 있어서 **모두 표시**한 것입니다(예: 150 / 200). 실제 운영 시에는 최신 스키마 기준으로 적용하세요. fileciteturn8file0

---

## 4. TRAFFIC_TYPE 상세

- **실시간 (`real`)**: 인증/카드승인/긴급공지·장애 등 **지연발송이 거의 없어야 하는 경우**  
- **일반 (`normal`)**: 일반적으로 **수초 이내 발송**되면 무방한 경우  
- **배치 (`batch`)**: 광고/이벤트 안내/공지 등 **일부 지연 허용**되지만 **대량 발송**해야 하는 경우 fileciteturn8file0

---

## 5. 운영 메모

- 발송 완료 시 `UMS_LOG_YYYYMM` 테이블로 이관되며, **스키마는 동일**합니다.  
- **KV_MSG**는 **통합 템플릿 발송 전용**으로 사용을 권장합니다. fileciteturn8file0

---

## 6. 샘플: CLIENT_KEY 생성

```sql
-- 유니크 메시지 키 생성 예시 (MySQL)
SELECT CONCAT(
  DATE_FORMAT(NOW(), '%Y%c%dT%H%i%s-'),
  FLOOR(0 + (RAND() * ((9999 - 0) + 1)))
) AS CLIENT_KEY;
```

---

### ✅ 끝.
