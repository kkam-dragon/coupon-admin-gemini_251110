<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>발송등록</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/themes/material_blue.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <link href="css/style.css" rel="stylesheet">
</head>
<body>
    <!-- Header will be injected here -->
    <div id="header-placeholder"></div>

    <div class="container mb-5">
        <h2 class="mb-4">발송등록</h2>
        <!-- 1. 기본 정보 조회 및 입력 -->
        <div class="card mb-4">
            <div class="card-title">1. 기본 정보 조회 및 입력</div>
            <div class="row g-3 align-items-center">
                <div class="col-md-2"><label for="clientName" class="form-label form-label-required">고객사</label></div>
                <div class="col-md-10">
                    <input type="text" id="clientName" class="form-control" placeholder="고객사명을 입력하세요. (30자이내)" maxlength="30">
                    <div id="clientName-feedback" class="form-text text-muted text-end"></div>
                </div>

                <div class="col-md-2"><label for="salesManager" class="form-label form-label-required">영업담당자</label></div>
                <div class="col-md-4">
                    <input type="text" id="salesManager" class="form-control" placeholder="담당자명을 입력하세요. (30자이내)" maxlength="30">
                    <div id="salesManager-feedback" class="form-text text-muted text-end"></div>
                </div>
                <div class="col-md-2"><label for="clientRequester" class="form-label form-label-required">고객사 요청자</label></div>
                <div class="col-md-4">
                    <input type="text" id="clientRequester" class="form-control" placeholder="요청자명을 입력하세요. (30자이내)" maxlength="30">
                    <div id="clientRequester-feedback" class="form-text text-muted text-end"></div>
                </div>

                <div class="col-md-2"><label for="requesterPhone" class="form-label">요청자 전화번호</label></div>
                <div class="col-md-4">
                    <input type="text" id="requesterPhone" class="form-control" placeholder="숫자만 입력하세요. (11자이내)" maxlength="11" oninput="this.value = this.value.replace(/[^0-9]/g, '');">
                    <div id="requesterPhone-feedback" class="form-text text-muted text-end"></div>
                </div>
                
                <div class="col-md-2"><label for="requesterEmail" class="form-label form-label-required">요청자 이메일</label></div>
                <div class="col-md-4">
                    <input type="email" id="requesterEmail" class="form-control" placeholder="이메일 주소를 입력하세요. (30자이내)" maxlength="30">
                    <div id="requesterEmail-feedback" class="form-text text-muted text-end"></div>
                </div>
            </div>
        </div>

        <!-- 발송 정보 -->
        <div class="card mb-4">
            <div class="row g-3 align-items-center">
                <div class="col-md-2"><label for="eventName" class="form-label form-label-required">이벤트명</label></div>
                <div class="col-md-5">
                    <input type="text" id="eventName" class="form-control" placeholder="이벤트명을 입력하세요 (50자 이내)" maxlength="50">
                    <div id="eventName-feedback" class="form-text text-muted text-end"></div>
                </div>
                <div class="col-md-2"><label for="dispatchDateTime" class="form-label form-label-required">발송 예약일시</label></div>
                <div class="col-md-3">
                    <div class="input-group" id="dispatchDateTime">
                        <input type="text" class="form-control" placeholder="날짜 및 시간을 선택하세요" data-input>
                        <span class="input-group-text" data-toggle>
                            <i class="fa-regular fa-calendar-alt"></i>
                        </span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content 2-Column Layout -->
        <div class="row">
            <!-- Left Column -->
            <div class="col-md-7 d-flex flex-column">
                <!-- 상품 정보 조회 -->
                <div class="card mb-4">
                    <div class="card-title">2. 상품 정보 조회</div>
                    <div class="row g-3 align-items-center">
                        <div class="col-md-2"><label for="productName" class="form-label form-label-required">상품명</label></div>
                        <div class="col-md-10">
                            <div class="input-group">
                                <input type="text" id="productName" class="form-control">
                                <button class="btn btn-outline-secondary" type="button" onclick="searchProduct()">검색</button>
                            </div>
                        </div>

                        <div class="col-md-2"><label for="product-expiry" class="form-label">유효기간</label></div>
                        <div class="col-md-4"><input type="text" id="product-expiry" class="form-control" readonly></div>
                        <div class="col-md-2"><label for="product-price" class="form-label">매입/정상 단가</label></div>
                        <div class="col-md-4"><input type="text" id="product-price" class="form-control" readonly></div>

                        <div class="col-md-2"><label for="product-location" class="form-label">교환처</label></div>
                        <div class="col-md-10"><input type="text" id="product-location" class="form-control" readonly></div>
                    </div>
                </div>

                <!-- 발송항목 입력 -->
                <div class="card mb-4 flex-grow-1">
                    <div class="card-title">3. 발송항목 입력</div>
                    <div class="row g-3 align-items-center">
                        <div class="col-md-2"><label for="mmsTitle" class="form-label form-label-required">제목</label></div>
                        <div class="col-md-10">
                            <input type="text" id="mmsTitle" class="form-control" placeholder="메시지 제목을 입력하세요. (20자이내)" maxlength="20">
                            <div id="mmsTitle-feedback" class="form-text text-muted text-end"></div>
                        </div>

                        <div class="col-md-2"><label for="mmsContent" class="form-label form-label-required">내용</label></div>
                        <div class="col-md-10">
                            <textarea id="mmsContent" class="form-control" rows="7" placeholder="메시지 내용을 입력하세요. (200자이내)" maxlength="200"></textarea>
                            <div id="mmsContent-feedback" class="form-text text-muted text-end"></div>
                        </div>

                        <div class="col-md-2"><label for="senderPhone" class="form-label form-label-required">발신자 번호</label></div>
                        <div class="col-md-10">
                            <input type="text" id="senderPhone" class="form-control" placeholder="숫자만 입력하세요. (11자이내)" maxlength="11" oninput="this.value = this.value.replace(/[^0-9]/g, '');">
                            <div id="senderPhone-feedback" class="form-text text-muted text-end"></div>
                        </div>

                        <div class="col-md-2">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="useBannerImage">
                                <label class="form-check-label" for="useBannerImage">배너 삽입(옵션)</label>
                            </div>
                        </div>
                        <div class="col-md-10"><input type="file" class="form-control" id="bannerImage" disabled></div>
                    </div>
                </div>
            </div>

            <!-- Right Column -->
            <div class="col-md-5">
                <!-- MMS 이미지 미리보기 -->
                <div class="card">
                    <div class="card-title card-title-preview">MMS 이미지 미리보기</div>
                    <div class="d-flex justify-content-center align-items-center p-3" style="background-color: #f8f9fa; min-height: 450px;">
                        <img src="images/sample-mms.png" alt="MMS 미리보기" class="img-fluid" style="max-height: 400px; object-fit: contain; border: 1px solid #dee2e6;">
                    </div>
                </div>

                <!-- 수신자 정보 등록 -->
                <div class="card mt-4">
                    <div class="card-title card-title-required">4. 수신자 정보 등록</div>
                    <ul class="nav nav-tabs" id="recipient-tabs" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="simple-reg-tab" data-bs-toggle="tab" data-bs-target="#simple-reg-panel" type="button" role="tab" aria-controls="simple-reg-panel" aria-selected="true">간편등록</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="bulk-reg-tab" data-bs-toggle="tab" data-bs-target="#bulk-reg-panel" type="button" role="tab" aria-controls="bulk-reg-panel" aria-selected="false">대량등록(엑셀)</button>
                        </li>
                    </ul>
                    <div class="tab-content pt-3" id="recipient-tabs-content">
                        <div class="tab-pane fade show active" id="simple-reg-panel" role="tabpanel" aria-labelledby="simple-reg-tab">
                            <div class="form-check mb-2">
                                <input class="form-check-input" type="checkbox" value="" id="simpleRegCheck" checked disabled>
                                <label class="form-check-label" for="simpleRegCheck">
                                    휴대폰 번호를 한 줄에 한 개씩 숫자만 입력하세요.<br> (최대 100건)
                                </label>
                            </div>
                            <div class="d-flex justify-content-end mb-2">
                                <button class="btn btn-sm btn-outline-secondary" id="resetSimpleRegBtn"><i class="fa-solid fa-times me-1"></i> 초기화</button>
                            </div>
                            <div class="input-group">
                                <div id="recipientLineNumbers" class="form-control text-end" style="flex: 0 0 45px; background-color: #f8f9fa; overflow-y: hidden; border-right: none; padding-right: 5px; user-select: none;"></div>
                                <textarea id="recipientList" class="form-control" rows="8" placeholder="01012345678" style="border-radius: 0;"></textarea>
                                <div id="recipientValidation" class="form-control text-center" style="flex: 0 0 40px; background-color: #f8f9fa; overflow-y: hidden; border-left: none; user-select: none;"></div>
                            </div>
                            <div id="recipientCount" class="form-text text-muted text-end mt-1">0 / 100건</div>
                        </div>
                        <div class="tab-pane fade" id="bulk-reg-panel" role="tabpanel" aria-labelledby="bulk-reg-tab">
                            <div class="form-check mb-2">
                                <input class="form-check-input" type="checkbox" value="" id="bulkRegCheck" checked disabled>
                                <label class="form-check-label" for="bulkRegCheck">
                                    최대 20,000건까지만 입력이 가능합니다.
                                </label>
                            </div>
                            <div class="d-flex justify-content-end mb-2">
                                <button class="btn btn-sm btn-outline-secondary" id="downloadSampleBtn"><i class="fa-solid fa-download me-1"></i> 샘플 엑셀 파일 다운로드</button>
                            </div>
                            <div style="min-height: 230px;"> <!-- 높이 유지를 위한 컨테이너 -->
                                <div class="input-group mb-2">
                                    <input type="file" class="form-control" id="excelFileInput" accept=".xlsx, .xls">
                                    <button class="btn btn-outline-secondary" type="button" id="resetExcelFileBtn" title="선택한 파일 초기화"><i class="fa-solid fa-times"></i></button>
                                </div>
                                <div class="table-responsive" id="excelPreviewContainer" style="height: 190px; display: none;">
                                    <table class="table table-striped table-sm table-hover">
                                        <thead class="table-light">
                                            <tr><th>#</th><th>휴대폰 번호</th></tr>
                                        </thead>
                                        <tbody id="excelPreviewBody"></tbody>
                                    </table>
                                </div>
                            </div>
                            <div id="excelRecipientCount" class="form-text text-muted text-end mt-1">총 0건</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Action Buttons -->
        <div class="d-flex justify-content-center mt-5">
            <button type="button" class="btn btn-primary btn-lg me-3 px-5" id="sendBtn">저장/발송</button>
            <button type="button" class="btn btn-secondary btn-lg px-5" id="cancelBtn">취소</button>
        </div>

    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://npmcdn.com/flatpickr/dist/l10n/ko.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="js/main.js"></script>
    <script>
        function logout() {
            if (confirm('로그아웃 하시겠습니까?')) { window.location.href = 'index.html'; }
        }

        // 헤더를 동적으로 로드하고 현재 페이지 메뉴를 활성화합니다.
        document.addEventListener("DOMContentLoaded", function() {
            // 페이지 로드 시 페이드인 효과 적용
            document.body.classList.add('loaded');

            fetch('partials/header.html')
                .then(response => response.text())
                .then(data => {
                    document.getElementById('header-placeholder').innerHTML = data;
                    document.getElementById('logoutBtn').addEventListener('click', logout);
                    document.getElementById('nav-sendCoupon').classList.add('active');
                })
                .catch(error => console.error('Error loading header:', error));
        });
    </script>

    <!-- Product Search Modal -->
    <div class="modal fade" id="productSearchModal" tabindex="-1" aria-labelledby="productSearchModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="productSearchModalLabel">상품 검색</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>상품명</th>
                                <th>교환처</th>
                                <th>선택</th>
                            </tr>
                        </thead>
                        <tbody id="product-list-table">
                            <!-- Product list will be injected here by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Unsaved Changes Confirmation Modal -->
    <div class="modal fade" id="unsavedChangesModal" tabindex="-1" aria-labelledby="unsavedChangesModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="unsavedChangesModalLabel">경고</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body text-center">
                    <p class="h5" id="unsavedChangesModalBody" style="font-weight: 400;">입력된 데이터가 삭제됩니다. 정말 이동하시겠습니까?</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">취소</button>
                    <button type="button" class="btn btn-primary" id="confirmNavigateBtn">확인</button>
                </div>
            </div>
        </div>
    </div>
</body>
</html>
